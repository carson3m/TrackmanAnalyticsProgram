<!-- templates/csv_summary.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>CSV Summary</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body class="container py-4">
    <h1>CSV Summary</h1>

    <!-- ðŸ“„ PDF Download Button -->
    <form method="GET" action="/download_pdf">
        <input type="hidden" name="team" value="{{ team }}">
        <input type="hidden" name="pitcher" value="{{ pitcher }}">
        <button type="submit" class="btn btn-primary mb-4">Download PDF Report</button>
    </form>

    <!-- ðŸ“Š Per-Pitch-Type Table -->
    <h3>Per-Pitch-Type Metrics</h3>
    <div class="table-responsive">
        {{ pitch_table | safe }}
    </div>

    <!-- ðŸ“ˆ Pitch Breaks Plot -->
    <h3 class="mt-5">Pitch Breaks</h3>
    <div id="breaksPlot" style="height:400px;"></div>

    <!-- ðŸ“ˆ Release Points Plot -->
    <h3 class="mt-5">Release Points</h3>
    <div id="releasePlot" style="height:400px;"></div>

    <script>
        const breaksData = {{ breaks_data | tojson }};
        const releaseData = {{ release_data | tojson }};

        const breaksTraces = breaksData.map(p => ({
            x: p.x,
            y: p.y,
            mode: 'markers',
            type: 'scatter',
            name: p.name
        }));

        const releaseTraces = releaseData.map(p => ({
            x: p.x,
            y: p.y,
            mode: 'markers',
            type: 'scatter',
            name: p.name
        }));

        Plotly.newPlot('breaksPlot', breaksTraces, {
            title: 'Pitch Breaks',
            xaxis: { title: 'Horizontal Break (in)', range: [-25, 25] },
            yaxis: { title: 'Vertical Break (in)', range: [-25, 25] }
        });

        Plotly.newPlot('releasePlot', releaseTraces, {
            title: 'Release Points',
            xaxis: { title: 'Horizontal Release Side (ft)', range: [-3.5, 3.5] },
            yaxis: { title: 'Vertical Release Height (ft)', range: [1.5, 6.5] }
        });
    </script>
</body>
</html>
